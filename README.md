# Трекер полезных привычек
API приложение для пподдержки выполнения пользователем задуманных привычек.
Приложение выполнено на фреймворке Django и Django REST framework.
PostgreSQL используется для сохранения данных.
Напоминания осуществляются уведомлениями через telegram-bot.
Периодические задачи реализованы посредством Celery и Celery Beat.


## Использование
Для работы с данным проектом:

1. В виртуальном окружении установите [requirements.txt](https://nodejs.org/) (пакет с зависимостями) с помощью команды:
```sh
$ pip install -r requirements.txt
```

2. Добавьте в свой проект файл [.env](https://nodejs.org/) c необходимыми для работы паролями. 
Пример [.env.sample](https://nodejs.org/)  размещен в проекте.



## Разработка

### Реализовано в проекте
В данном проекте реализовано два приложения:

```sh
habits
users
```
В каждом по соответствующей модели.
Для моделей реализован контроллеры через ViewSet

### users

Реализован класс User для дальнейшего определения пользователей сервиса.

Для работы с сервисом реализовано получение пользователем токена.

Реализовано ограничение прав доступа:
Каждый пользователь может работать со своими привычками в приватном формате
(никто из посторонних пользователей не сможет увидеть привычки другого пользователя)
или опубликовать свои привычки с флагом публичности.


### habits

Реализован класс Habit для создания привычек.

Пример привычки описывается как конкретное действие, которое можно уложить в одно предложение:

```sh
я буду [ДЕЙСТВИЕ] в [ВРЕМЯ] в [МЕСТО]
```
Пример привычки является образцом для отправки через телеграм-бота,
в связи с этим при создании привычки обязательными полями выступают:
Действие, Время и Место.

К модели привычки применены следующие валидации:
За каждую полезную привычку необходимо себя вознаграждать или сразу после делать приятную привычку.
Но при этом привычка не должна расходовать на выполнение больше двух минут.

Для списка привычек реализована пагинация (5 привычек на страницу)


### Запуск Telegram-bot

1. Пользователю необходимо получить свой [Current chat ID](https://nodejs.org/)

Для этого в приложении телеграм найти пользователя [Get My ID](https://nodejs.org/)
-> /start 

Полученный ID использовать при регистрации или редактировании профиля.

После заполнения привчек можно переходить к телеграм боту:

```sh
good_habits_drf_bot
```

При нажатии [/start ](https://nodejs.org/) бот будет уведомлять пользователя о заданной привычки в заданное время.


## To do
- [x] Настроен CORS.
- [x] Настроена интеграцию с Телеграмом.
- [x] Реализована пагинация для модели Habit приложения habits.
- [x] Использованы переменные окружения.
- [x] Необходимые модели описаны или переопределены.
- [x] Реализованы необходимые эндпоинты:
- Регистрация.
- Авторизация.
- Список привычек текущего пользователя с пагинацией.
- Список публичных привычек.
- Создание привычки.
- Редактирование привычки.
- Удаление привычки.
- [x] Настроены валидаторы:
- Исключен одновременный выбор связанной привычки и указания вознаграждения.
- Время выполнения должно быть не больше 120 секунд.
- У приятной привычки не может быть вознаграждения или связанной привычки.
- Нельзя выполнять привычку реже, чем 1 раз в 7 дней.
- [x] Описанные права доступа.
- [x] Настроена отложенная задача через Celery
- [x] Имеется список зависимостей.
- [x] Результат проверки Flake8 равен 100%, при исключении миграций.
- [x] Для быстрого масштабирования проекта применяется контейнеризация. Проект завернут в Docker.


## Настройка и запуск Docker

Для работы с Docker на компьютере должен быть установлен Docker и docker-compose 

Для запуска докера на локальном хосте необходимо выполнить команду:
```sh
docker-compose up -d --build
```


## Источники

1. Telegram API и боты - [python 101 course](https://dshubenok.github.io/week4/telegram-api/)
2. SimpleJWT (token). Официальная документация - [Simple JWT](https://django-rest-framework-simplejwt.readthedocs.io/en/latest/getting_started.html)
3. Настройка urls для ViewSet - [Tutorial 6: ViewSets & Routers](https://www.django-rest-framework.org/tutorial/6-viewsets-and-routers/)
4. Настройка кастомных ограничений прав доступа - [Permissions](https://www.django-rest-framework.org/api-guide/permissions/)
5. Настройка CORS. Официальная документация. - [django-cors-headers](https://pypi.org/project/django-cors-headers/)
6. Интерактивная документация API. Официальная документация - [drf-yasg](https://drf-yasg.readthedocs.io/en/stable/readme.html)
7. Celery. Официальная документация - [Celery](https://docs.celeryq.dev/en/stable/django/first-steps-with-django.html)
8. Celery-beat. Официальная документация - [Celery Beat](https://docs.celeryq.dev/en/stable/userguide/periodic-tasks.html)
9. Docker - Инструкции по установке [Docker Desktop on Windows](https://docs.docker.com/desktop/install/windows-install/)
10. Docker - Дополнительный справочный ресурс [Docker Hub](https://hub.docker.com/)